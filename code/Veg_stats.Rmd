---
title: "VegData_stats"
author: "Becca Morris"
date: "2024-02-03"
output: html_document
---

```{r setup, include=FALSE}
library(readxl)
library(tidyverse)
library(ggplot2)
library(broom)
library(AICcmodavg)
library(glmmTMB)

setwd("~/GitHub/BeccaTransects/data")

vegmetadata <- read_xlsx("~/GitHub/BeccaTransects/data/VegData_raw.xlsx", sheet = "Metadata")
vegdata <- read_xlsx("~/GitHub/BeccaTransects/data/VegData_raw.xlsx", sheet = "Data")
```

#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!#
# 1. creating the main data frame:
```{r}
vegdata2 <- vegdata %>% 
  mutate_at(c('MeIn', 'DiGr', 'RaSa', 'CaMa', 'SaSo', 'Lolium', 'FrSa', 'Fabiaceae','Vicia', 'Sonc', 'Xant', 'LeTr', 'Ranunculus', 
              'Taraxacum', 'Coytote_Bush','BoMa', 'DiSp'), as.numeric) %>% 
  mutate_if(is.numeric, list(~replace_na(., 0))) %>%
  filter(!(BaGr_Type_1 == '7' | BaGr_Type_2 == '7')) %>% #remove rows where BaGr is coded as log
  select(-BaGr_Type_1, -BaGr_Type_2, -Coytote_Bush, -Wrack, -Tot_Num_Species, -Shoot_Density, -Length_centimeters, -Patch_Type) %>% 
  mutate(BaGr = rowSums(across(BaGr_1:BaGr_2), na.rm = T)) %>% 
  select(-BaGr_1, -BaGr_2) %>% 
  mutate(Total_Veg = 25-BaGr) %>%  #Total_Veg is simply what is remaining after subtracting the bare ground
  #mutate(across(SpFo:Total_Veg, ~ .x*4)) %>%  #makes percentages out of the counts
  mutate(Date = paste0(Year, "-", Month)) #%>% 
  #mutate(Total_Veg2 = rowSums(across(SpFo:LeTr))) %>% 
  #filter(!Total_Veg2 == 0)  #Total_Veg2 adds all the total quadrants each species is present in and combining them all into one total count.
```

#### Using Full_Join to combine main data sheet and metadata sheet ####

# 2. First I want to clean up the metadata sheet:
```{r}
vegmetadata %>% 
  select(Transect_ID, Shoreline_End, Log_Presence)
```

# 3. Now to merge the two data frames together, combine pickleweed species into a single column, distirbute picklepups into SaPa and SaDe columns, combine grasses into one column, and remove the redunant columns:
```{r}
vegdatamerged <- full_join(vegdata2, vegmetadata, by = "Transect_ID") %>% 
  select(-c(...9:...12)) %>% 
  mutate(SaSp = SaPa + SaDe) %>% 
  mutate(SaPa_new = SaPa + ((SaPa/SaSp)*PicklePups)) %>% 
  mutate(SaDe_new = SaDe + ((SaDe/SaSp)*PicklePups)) %>% 
  mutate(Grass = GrGR + LeTr + MixedSeedlings) %>% 
  mutate(across(everything(), ~replace(.x, is.nan(.x), 0))) %>% 
  mutate(SaPa = SaPa_new) %>%  #putting the new columns back to their original names
  mutate(SaDe = SaDe_new) %>% 
  select(-c('GrGR','LeTr','MixedSeedlings','SaPa','SaDe','PicklePups'))
```

# 4. Now to break the data up into the three zones and remove the reference logs. 
# *The middle zone contains logs, so I'll need to make the log location's NA's:

# Upper Zone:
```{r}
vegdata_U <- vegdatamerged[(vegdatamerged$Zone == "U" & vegdatamerged$Log_Presence != "reference"),]
```
# Middle Zone:
```{r}
vegdata_M <- vegdatamerged[(vegdatamerged$Zone == "M" & vegdatamerged$Log_Presence != "reference"),]
```
# Lower Zone:
```{r}
vegdata_L <- vegdatamerged[(vegdatamerged$Zone == "L" & vegdatamerged$Log_Presence != "reference"),]
```



#!!!!!!!!!!!!!!!!!!!!!!#
# 5. Test for normality:

# Upper Zone Normality using the Total_Veg2 column created in step 1:
```{r}
#QQ-Plot:
qqnorm(vegdata_U$Total_Veg2, pch = 1, frame = FALSE)
qqline(vegdata_U$Total_Veg2, col = "steelblue", lwd = 2)

# QQ gamma dist:
set.seed(17)
vegdata_U$Total_Veg2 <- rgamma(2408,1)

qqnorm(vegdata_U$Total_Veg2, pch = 1, frame = FALSE)
qqline(vegdata_U$Total_Veg2, col = "steelblue", lwd = 2)

# QQ Chi-square dist:
set.seed(17)
vegdata_U$Total_Veg2 <- rchisq(2408,5)  

qqnorm(vegdata_U$Total_Veg2, pch = 1, frame = FALSE)
qqline(vegdata_U$Total_Veg2, col = "steelblue", lwd = 2)

#histogram
hist(vegdata_U$Total_Veg2)
```
# Middle Zone Normality:
```{r}
#QQ-Plot:
qqnorm(vegdata_M$Total_Veg2, pch = 1, frame = FALSE)
qqline(vegdata_M$Total_Veg2, col = "steelblue", lwd = 2)

#histogram
hist(vegdata_M$Total_Veg2)
```
# Lower Zone Normality:
```{r}
#QQ-Plot:
qqnorm(vegdata_L$Total_Veg2, pch = 1, frame = FALSE)
qqline(vegdata_L$Total_Veg2, col = "steelblue", lwd = 2)

#histogram
hist(vegdata_L$Total_Veg2)
```

#### ANOVA: tests whether any of the group means are different from the overall mean of the data by checking the variance of each individual group against the overall variance of the data. If one or more groups falls outside the range of variation predicted by the null hypothesis (all group means are equal), then the test is statistically significant. 
```{r}

```

#### GLM:

#Upper Zone GLM:
```{r}
hist((vegdata_U$Total_Veg2[vegdata_U$Date == "2023-August"]))

glm1 <- glm((Total_Veg2) ~ Shoreline_End*Log_Presence,
               data = vegdata_U[vegdata_U$Date == "2023-August",],
               family = gaussian)

glm1
plot(glm1)
anova(glm1, test = "F")

```


# ################################################################################################################################ #

#Analyzing Bare ground vs Total Veg using the "Total_Veg" column:
```{r}
#Question: Does Shoreline_End*Log_Presence*Zone affect how much veg/bare ground is present?
  
#need to create a new column that gives a "1" when veg is present and "0" when no veg is present"
vegdata_U <- vegdatamerged[(vegdatamerged$Zone == "U" & vegdatamerged$Log_Presence != "reference"),] %>% 
  mutate(Vegetation = +(Total_Veg>=1))

vegdata_M <- vegdatamerged[(vegdatamerged$Zone == "M" & vegdatamerged$Log_Presence != "reference"),] %>% 
  mutate(Vegetation = +(Total_Veg>=1))

vegdata_L <- vegdatamerged[(vegdatamerged$Zone == "L" & vegdatamerged$Log_Presence != "reference"),] %>% 
  mutate(Vegetation = +(Total_Veg>=1))
```