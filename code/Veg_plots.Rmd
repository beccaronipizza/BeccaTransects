---
title: "Vegetation Plots EvW and L v NL"
output: html_notebook
---
```{r}
library(readxl)
library(tidyverse)
library(dplyr)
library(viridisLite)
library(lubridate)
library(naniar) #allows you to use the replace_with_na_at()
library(gridExtra)
library(ggtext)
library(ggpubr)
library(mdthemes)
```

```{r}
setwd("~/GitHub/BeccaTransects/data")

vegmetadata <- read_xlsx("~/GitHub/BeccaTransects/data/VegData_raw.xlsx", sheet = "Metadata")
vegdata <- read_xlsx("~/GitHub/BeccaTransects/data/VegData_raw.xlsx", sheet = "Data_2") #for log zone removal use sheet = "Data2_LZ" <- make sure htat right name
```
# !!!!! USE this set up only for the plots below.  FOr CHANGE barplots, set up the df down lower!!
```{r}
# 1. creating the main data frame:

#First, I need to replace all BaGr values with NA's where it is coded as log (as seens in the filter() row):
vegdata2 <- vegdata %>% 
  mutate_at(c('MeIn', 'DiGr', 'RaSa', 'CaMa', 'SaSo', 'Lolium', 'FrSa', 'Fabiaceae','Vicia', 'Sonc', 'Xant', 'LeTr', 'Ranunculus', 
              'Taraxacum', 'Coytote_Bush','BoMa', 'DiSp', 'AtPx', 'PoAr', 'AcMa', 'GrSt', 'MixedSeedlings','GrGR', 'Melilotus', 'MePo'), as.numeric) %>% 
  mutate_if(is.numeric, list(~replace_na(., 0))) %>%
  select(-BaGr_Type_1, -BaGr_Type_2, -Coytote_Bush, -Wrack, -Tot_Num_Species, -Shoot_Density, -Length_centimeters, -Patch_Type) %>% 
  mutate(SaSp = SaPa + SaDe) %>% 
  mutate(SaPa_new = SaPa + ((SaPa/SaSp)*PicklePups)) %>% #distributing the picklepups between the two species
  mutate(SaDe_new = SaDe + ((SaDe/SaSp)*PicklePups)) %>% 
  mutate(Grass = GrGR + LeTr + MixedSeedlings) %>% 
  mutate(BaGr = rowSums(across(BaGr_1:BaGr_2), na.rm = T)) %>% 
  select(-BaGr_1, -BaGr_2) %>% 
  mutate(Total_Veg = 25-BaGr) %>%  #Total_Veg is simply what is remaining after subtracting the bare ground
  #mutate(across(SpFo:Total_Veg, ~ .x*4)) %>%  makes percentages out of the counts
  mutate(across(everything(), ~replace(.x, is.nan(.x), 0))) %>%
  select(-c('GrGR','LeTr','MixedSeedlings','PicklePups', 'SaPa','SaDe', 'SaSp')) %>%  #removed SaSp so it would not be calculated as total veg in addition tot he SaPa and SaDe columns
  rename(SaPa = SaPa_new, SaDe = SaDe_new) %>% #putting their original names back after the calculation above
  mutate(Date = paste0(Year, "-", Month)) %>% 
  #relocate(Log_Zone, .after = last_col()) %>% 
  mutate(across(SpFo:Grass, ~ .x*4)) %>% #makes everything into percentages
  mutate(Total_Veg2 = rowSums(across(SpFo:Grass), na.rm =T)) %>%  #Total_Veg2 adds all the total quadrants each species is present in and combining them all into one
  pivot_longer(cols = SpFo:BaGr,
                names_to = "Species_code",
                values_to = "Percent_cover")
  #filter(is.na(Log_Zone))  #remove rows where the quad that lands on log and the one quad that lands above and below are marked as "R" for remove

```

#I want to clean up the metadata sheet:
```{r}
vegmetadata %>% 
  select(Transect_ID, Shoreline_End, Log_Presence) 
  
```

#I want to combine the veg data and veg metadata df's togetherand remove the extranneous columns:
```{r}
vegdata_merged <- full_join(vegdata2, vegmetadata, by = "Transect_ID") %>% 
  select(-c(...9:...12))
```


# #################################################################################################################################### #
#Creating a df just for SpFo for BARPLOT:
```{r}
SpFo <- vegdata_merged[(vegdata_merged$Species_code == 'SpFo' & vegdata_merged$Date == '2022-June' | vegdata_merged$Species_code == 'SpFo' &         vegdata_merged$Date == '2023-August'),] %>% 
  rename(Percent_Spartina = Percent_cover) %>% 
  select(-c('Species_code','Fence_Presence', 'Pre-veg', 'Planted_cordgrass', 'Mud', 'Toeberm', 'Month', 'Year')) %>% 
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(Percent_Spartina, na.rm = TRUE),
            sd_cover = sd(Percent_Spartina, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
  
```
#set up the color-blind color palette
```{r}
cbp <- c("#F0E442", "#CC79A7", "#0072B2","#D55E00", "#009E73", "#56B4E9","#E69F00", "#000000")
```

#SpFo BARPLOT:
```{r}
SpFo_barplot <- ggplot(SpFo, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Date,
                                color = Date)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  scale_fill_manual(values = cbp1) +
  facet_grid(Shoreline_End ~ Log_Presence) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(0, 100)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Spartina foliosa Cover Based On Presence of Log per Marsh Zone",
    subtitle = "Comparing first survey (Jun 2022) to final survey (Aug 2023)",
    x = "Marsh Zone",
    y ="Total Spartina Cover (%)",
    fill = "Survey Date",
    caption = "*Error bars reflect standard error") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        legend.title = element_text(face = "bold", size=14),
        legend.text=element_text(size=12),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover), 
                vjust = -0.975, 
                hjust = 0.5, #higher values shift text horizontally left
                position = position_dodge(0.85),
                color = "black",
            size = 3.25)
  


SpFo_barplot
```


# SpFO Scatter Plot
# *Data isn't set up for this really. I think you need to undo the hashtags below:
```{r}
SpFo <- vegdata_merged[(vegdata_merged$Species_code == 'SpFo' & vegdata_merged$Date == '2022-June' | vegdata_merged$Species_code == 'SpFo' &         vegdata_merged$Date == '2023-August'),] %>% 
  rename(Percent_Spartina = Percent_cover) %>% 
  select(-c('Species_code','Fence_Presence', 'Pre-veg', 'Planted_cordgrass', 'Mud', 'Toeberm', 'Month', 'Year')) %>% 
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(Percent_Spartina, na.rm = TRUE),
            sd_cover = sd(Percent_Spartina, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log"))) #%>%
  #arrange(Date) %>% #not sure if this line matters
  #group_by(Zone, Shoreline_End, Log_Presence) %>% 
  #mutate(Percent_Change = (last(mean_cover) - first(mean_cover))) %>% 
  #mutate(Percent_Change = abs(Percent_Change)) %>% 
  #select(-c('Date')) %>%
  #distinct()


SpFo_scatter <- ggplot(SpFo, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Log_Presence,
                                color = Log_Presence)) +
  geom_point() +
  scale_fill_manual(values = cbp) +
  facet_grid(Shoreline_End ~.,) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(25, 100)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Vegetation Cover Based On Presence of Log per Marsh Zone",
    subtitle = "June 2022",
    x = "Marsh Zone",
    y ="Total Vegetated Cover (%)",
    fill = "Log Presence",
    caption = "*Error bars reflect standard error") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=16),
        legend.title = element_text(face = "bold", size=15),
        legend.text=element_text(size=15),
        axis.text.x = element_text(size = 15),
        axis.text.y = element_text(size = 13),
        plot.title = element_text(face = "bold", size = 15),
        plot.caption = element_text(size = 13),
        plot.subtitle = element_text(size = 13),
        strip.text = element_text(size = 18, color = "black"))


SpFo_scatter
```

# #################################################################################################################################### #
#Creating a df just for SaPa for BARPLOT:
```{r}
SaPa <- vegdata_merged[(vegdata_merged$Species_code == 'SaPa' & vegdata_merged$Date == '2022-June' | vegdata_merged$Species_code == 'SaPa' &         vegdata_merged$Date == '2023-August'),] %>% 
  rename(Percent_Pickleweed = Percent_cover) %>% 
  select(-c('Species_code','Fence_Presence', 'Pre-veg', 'Planted_cordgrass', 'Mud', 'Toeberm', 'Month', 'Year')) %>% 
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(Percent_Pickleweed, na.rm = TRUE),
            sd_cover = sd(Percent_Pickleweed, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))

```
#SaPa BARPLOT:
```{r}
SaPa_barplot <- ggplot(SaPa, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Zone,
                                color = Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  scale_fill_manual(values = cbp) +
  facet_grid(Shoreline_End ~ Log_Presence) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(0, 130)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change Salicornia pacifica Cover",
    subtitle = "Comparing first survey (Jun 2022) to final survey (Aug 2023)",
    x = "Marsh Zone",
    y ="Total Pickleweed Cover (%)",
    fill = "Survey Date",
    caption = "*Error bars reflect standard error") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        legend.title = element_text(face = "bold", size=14),
        legend.text=element_text(size=12),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover), 
                vjust = -0.975, 
                hjust = 0.5, #higher values shift text horizontally left
                position = position_dodge(0.85),
                color = "black",
            size = 3.25)
  


SaPa_barplot
```



# #################################################################################################################################### #
#Creating a df for Total Veg BARPLOT:
```{r}
TotalVeg <- vegdata_merged[(vegdata_merged$Species_code == 'Total_Veg' & vegdata_merged$Date == '2022-June' | vegdata_merged$Species_code == 'Total_Veg' & vegdata_merged$Date == '2023-August'),] %>% 
  rename(Percent_Cover = Percent_cover) %>% 
  select(-c('Species_code','Fence_Presence', 'Pre-veg', 'Planted_cordgrass', 'Mud', 'Toeberm', 'Month', 'Year')) %>% 
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(Percent_Cover, na.rm = TRUE),
            sd_cover = sd(Percent_Cover, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```
#Total Veg BARPLOT:
```{r}
TotalVeg_barplot <- ggplot(TotalVeg, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Date,
                                color = Date)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  scale_fill_manual(values = cbp) +
  facet_grid(Shoreline_End ~ Log_Presence) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(0, 140)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Vegetation Cover Based On Presence of Log per Marsh Zone",
    subtitle = "Comparing first survey (Jun 2022) to final survey (Aug 2023)",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Survey Date",
    caption = "*Error bars reflect standard error") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        legend.title = element_text(face = "bold", size=14),
        legend.text=element_text(size=12),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover), 
                vjust = -0.975, 
                hjust = 0.5, #higher values shift text horizontally left
                position = position_dodge(0.85),
                color = "black",
            size = 3.25)
  


TotalVeg_barplot
```



# #################################################################################################################################################### #


#Total Veg CHANGE BARPLOT:
```{r}
##
#calculating change in cover for total veg (where total can exceed 25) and then the mean change for each zone, shoreline end, and log presence:

vegdata2 <- vegdata %>% 
  mutate_at(c('MeIn', 'DiGr', 'RaSa', 'CaMa', 'SaSo', 'Lolium', 'FrSa', 'Fabiaceae','Vicia', 'Sonc', 'Xant', 'LeTr', 'Ranunculus', 'Taraxacum', 'Coytote_Bush','BoMa', 'DiSp', 'AtPx', 'PoAr', 'AcMa', 'GrSt', 'MixedSeedlings','GrGR', 'Melilotus', 'MePo'), as.numeric) %>% 
  mutate_if(is.numeric, list(~replace_na(., 0))) %>%
  select(-BaGr_Type_1, -BaGr_Type_2, -Coytote_Bush, -Wrack, -Tot_Num_Species, -Shoot_Density, -Length_centimeters, -Patch_Type) %>% 
  mutate(SaSp = SaPa + SaDe) %>% 
  mutate(SaPa_new = SaPa + ((SaPa/SaSp)*PicklePups)) %>%      #combine and distribute picklepup category amongst the two species
  mutate(SaDe_new = SaDe + ((SaDe/SaSp)*PicklePups)) %>% 
  mutate(across(c('SaPa_new', 'SaDe_new'),(~replace_na(., 0)))) %>%   #where the calculations above = 0, R was turning them into NaN's
  mutate(SaPa_new = ifelse(SaPa > 25, 25, SaPa_new)) %>%      #these lines tell it where these columns exceed 25 quad's, to just set them = to 25
  mutate(SaDe_new = ifelse(SaDe_new > 25, 25, SaDe_new)) %>% 
  mutate(Grass = GrGR + LeTr + MixedSeedlings) %>% 
  mutate(Grass = ifelse(Grass > 25, 25, Grass)) %>% 
  mutate(BaGr = rowSums(across(BaGr_1:BaGr_2), na.rm = T)) %>% 
  select(-BaGr_1, -BaGr_2) %>% 
  mutate(Total_Veg = 25-BaGr) %>%  #Total_Veg is simply what is remaining after subtracting the bare ground
  #mutate(across(SpFo:Total_Veg, ~ .x*4)) %>%  #makes percentages out of the counts
  mutate(across(everything(), ~replace(.x, is.nan(.x), 0))) %>%
  select(-c('GrGR','LeTr','MixedSeedlings','PicklePups', 'SaPa','SaDe','SaSp')) %>% #removed SaSp column so it would not be counted as part of 'Total_Veg2' column in addition to the SaPa and SaDe columns
  rename(SaPa = SaPa_new, SaDe = SaDe_new) %>% #putting their original names back after the calculation above
  mutate(across(c('SaPa', 'SaDe'), ~round(., 0))) %>% 
  #relocate(Log_Zone, .after = last_col()) %>%    #if you want to use log zone you need to upload the vegdata spreadsheet using the Data_2_LZ sheet.
  mutate(across(SpFo:Grass, ~ .x*4)) %>% #makes everything into percentages
  mutate(Total_Veg2 = rowSums(across(SpFo:Grass))) %>% #Total_Veg2 adds all the total quadrants each species is present in and combining them all into one total count (can exceed 100)
  mutate(Date = paste0(Year, "-", Month)) #%>% 
  #filter(is.na(Log_Zone))  #remove rows where the quad that lands on log and the one quad that lands above and below are marked as "R" for remove
  #filter(!Total_Veg2 == 0)  #remove all rows where total_veg is equal to 0

vegmetadata %>% 
  select(Transect_ID, Shoreline_End, Log_Presence)

vegdatamerged <- full_join(vegdata2, vegmetadata, by = "Transect_ID") %>% 
  select(-c(...9:...12)) 
```

```{r}
TotalVeg_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>%
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(Total_Veg2),
         final_count = last(Total_Veg2),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the June count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```
```{r}
cbp <- c("#F0E442", "#CC79A7", "#0072B2","#D55E00", "#009E73", "#56B4E9","#E69F00", "#000000")
```

```{r}
TotalVeg_change_barplot <- ggplot(TotalVeg_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                group = Log_Presence,
                                fill = Log_Presence,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 45)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in Total Vegetation Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Log Presence",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-TotalVeg_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=13),
        legend.title = element_text(face = "bold", size=09),
        legend.text=element_text(size=09),
        legend.position = "top",   #for no legend type: "none"
        legend.background = element_rect(fill="lightgrey",
                                  size=0.5, linetype="solid", 
                                  colour ="darkgrey"),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 14),
        plot.caption = element_text(size = 09),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  #geom_text(aes(label = mean_cover, y=0), #geom text is for the labels over the bars
   #             vjust = -.5,  #higher values shift text down                
    #            #hjust = 0.5, #higher values shift text horizontally left
     #           position = position_dodge(0.85),
      #          color = "black",
       #     size = 3.25) +
  geom_label(aes(label = mean_cover, y = -07),  # Adjust the x-coordinate
           vjust = -0.5,
           color = "black",
           position = position_dodge(0.85),
           size = 3.25,
           fill = "lightgrey",
           label.padding = unit(0.15, "lines"),
           label.r = unit(0.15, "lines"))

TotalVeg_change_barplot
```

#Total Veg Change Barplot without Log Presence:
```{r}
TotalVeg_change2 <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>%
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(Total_Veg2),
         final_count = last(Total_Veg2),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the June count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")))
         #Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```
```{r}
TotalVeg_change_barplot2 <- ggplot(TotalVeg_change2, 
                                mapping = aes(x = Zone,
                                y = mean_cover,
                                group = Log_Presence,
                                fill = Log_Presence,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(0, 40)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in Total Vegetation Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
   #fill = "Log Presence",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-TotalVeg_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y=0), #geom text is for the labels over the bars
                vjust = -.5,  #higher values shift text down                
                #hjust = 0.5, #higher values shift text horizontally left
                position = position_dodge(0.85),
                color = "black",
            size = 3.25)

TotalVeg_change_barplot2
```

# ##################################################################################################################################### #

#SaPa CHANGE BARPLOT:
```{r}
#new
SaPa_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(SaPa),
         final_count = last(SaPa),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the June count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```

```{r}
SaPa_change_barplot <- ggplot(SaPa_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                group = Log_Presence,
                                fill = Log_Presence,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-23, 30)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = expression(paste(bold("Mean % Change in " *italic("Salicornia pacifica")* " Cover"))),
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Log Presence",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SaPa_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=13),
        legend.title = element_text(face = "bold", size=09),
        legend.text=element_text(size=09),
        legend.position = "top",   #for no legend type: "none"
        legend.background = element_rect(fill="lightgrey",
                                  size=0.5, linetype="solid", 
                                  colour ="darkgrey"),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 14),
        plot.caption = element_text(size = 09),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
   #geom_text(aes(label = mean_cover, y= -25), #geom text is for the labels over the bars
    #             vjust = -.5,  #higher values shift text down                
     #            #hjust = 0.5, #higher values shift text horizontally left
      #           position = position_dodge(0.85),
       #          color = "black",
        #     size = 3.25)
  geom_label(aes(label = mean_cover, y = -25),  # Adjust the x-coordinate
           vjust = -0.5,
           color = "black",
           position = position_dodge(0.85),
           size = 3.25,
           fill = "lightgrey",
           label.padding = unit(0.15, "lines"),
           label.r = unit(0.15, "lines"))

SaPa_change_barplot
```

# ##################################################################################################################################################### #

#SpFo CHANGE BARPLOT

```{r}
#new
SpFo_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  #mutate(SpFo_new = Total_Veg2-SpFo) %>% 
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(SpFo),
         final_count = last(SpFo),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```
```{r}
SpFo_change_barplot <- ggplot(SpFo_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                group = Log_Presence,
                                fill = Log_Presence,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 40)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = expression(paste(bold("Mean % Change in " *italic("Spartina foliosa")* " Cover"))),
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Log Presence",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SpFo_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=13),
        legend.title = element_text(face = "bold", size=09),
        legend.text=element_text(size=09),
        legend.position = "top",   #for no legend type: "none"
        legend.background = element_rect(fill="lightgrey",
                                  size=0.5, linetype="solid", 
                                  colour ="darkgrey"),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 14),
        plot.caption = element_text(size = 09),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  #geom_text(aes(label = mean_cover, y=-1), #geom text is for the labels over the bars
   #             vjust = -.5,  #higher values shift text down                
    #            #hjust = 0.5, #higher values shift text horizontally left
     #           position = position_dodge(0.85),
      #          color = "black",
       #     size = 3.25) +
  geom_label(aes(label = mean_cover, y = -07),  # Adjust the x-coordinate
           vjust = -0.5,
           color = "black",
           position = position_dodge(0.85),
           size = 3.25,
           fill = "lightgrey",
           label.padding = unit(0.15, "lines"),
           label.r = unit(0.15, "lines"))

SpFo_change_barplot
```
# ################################################################################################################################################### #

#SaDe CHANGE BARPLOT:
```{r}
#new
SaDe_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(SaDe),
         final_count = last(SaDe),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```

```{r}
SaDe_change_barplot <- ggplot(SaDe_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Zone,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(Log_Presence ~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 50)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in *Salicornia depressa* Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Marsh Zone",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SaDe_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y = mean_cover + se_cover), #geom text is for the labels over the bars
                vjust = -1,  #higher values shift text down
                hjust = 0.5, #higher values shift text horizontally left
                position = position_stack(),
                color = "black",
            size = 3.25)

SaDe_change_barplot
```

# ################################################################################################################################################### #

#SaSp CHANGE BARPLOT:
```{r}
#new
SaSp_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  group_by(Transect_ID, Quadrat) %>% 
  mutate(SaSp = SaPa + SaDe) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(SaSp),
         final_count = last(SaSp),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```

```{r}
SaSp_change_barplot <- ggplot(SaSp_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Zone,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(Log_Presence ~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 50)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in *Pickleweed* Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Marsh Zone",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SaSp_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y = mean_cover + se_cover), #geom text is for the labels over the bars
                vjust = -1,  #higher values shift text down
                hjust = 0.5, #higher values shift text horizontally left
                position = position_stack(),
                color = "black",
            size = 3.25)

SaSp_change_barplot
```


# ################################################################################################################################################### #

#Spartina AND Pickleweed cover CHANGE BARPLOT:
```{r}
#new
DomSpec_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  group_by(Transect_ID, Quadrat) %>%
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(SaPainitial_count = first(SaPa),
         SaPafinal_count = last(SaPa),
         SaPacount_difference = (SaPafinal_count - SaPainitial_count)) %>%
   mutate(SpFoinitial_count = first(SpFo),
         SpFofinal_count = last(SpFo),
         SpFocount_difference = (SpFofinal_count - SpFoinitial_count)) %>%
  mutate(DomSpec_countdifference = SaPacount_difference + SpFocount_difference) %>% 
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(DomSpec_countdifference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(DomSpec_countdifference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```

```{r}
DomSpec_change_barplot <- ggplot(DomSpec_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Zone,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(Log_Presence ~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 50)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = expression(paste(bold("Mean % Change in Dominant Species Cover ~ " * italic("S. pacifica") * " and " * italic("S. foliosa")))), 
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Marsh Zone",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-DomSpec_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y = mean_cover + se_cover), #geom text is for the labels over the bars
                vjust = -1,  #higher values shift text down
                hjust = 0.5, #higher values shift text horizontally left
                position = position_stack(),
                color = "black",
            size = 3.25) 



DomSpec_change_barplot
```




# ################################################################################################################################################### #

#CoCo CHANGE BARPLOT:
```{r}
#new
CoCo_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(CoCo),
         final_count = last(CoCo),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```

```{r}
CoCo_change_barplot <- ggplot(CoCo_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Zone,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(Log_Presence ~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 50)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in *Cotula coronopifilia* Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Marsh Zone",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SaDe_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y = mean_cover + se_cover), #geom text is for the labels over the bars
                vjust = -1,  #higher values shift text down
                hjust = 0.5, #higher values shift text horizontally left
                position = position_stack(),
                color = "black",
            size = 3.25)

CoCo_change_barplot
```
# ################################################################################################################################################### #

#SpMa CHANGE BARPLOT:
```{r}
#new
SpMa_change <- vegdatamerged[(vegdatamerged$Log_Presence != "reference"),] %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(SpMa),
         final_count = last(SpMa),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log")))
```

```{r}
SpMa_change_barplot <- ggplot(SpMa_change, 
                        mapping = aes(x = Zone,
                                y = mean_cover,
                                fill = Zone,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(Log_Presence ~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-5, 50)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in *Spergularia spp.* Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Marsh Zone",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SpMa_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y = mean_cover + se_cover), #geom text is for the labels over the bars
                vjust = -1,  #higher values shift text down
                hjust = 0.5, #higher values shift text horizontally left
                position = position_stack(),
                color = "black",
            size = 3.25)

SpMa_change_barplot
```

```{r}
figure <- ggarrange(DomSpec_change_barplot, SaPa_change_barplot, SpFo_change_barplot,
                    labels = c("A", "B", "C"),
                    ncol = 3, nrow = 1)

figure
```










# ################################################################################################################################################################ #
#RELATIVE SpFO Barplot
```{r}
vegmetadata <- read_xlsx("~/GitHub/BeccaTransects/data/VegData_raw.xlsx", sheet = "Metadata")
vegdata <- read_xlsx("~/GitHub/BeccaTransects/data/VegData_raw.xlsx", sheet = "Data_2")
```

```{r}
vegdata2 <- vegdata %>% 
  mutate_at(c('MeIn', 'DiGr', 'RaSa', 'CaMa', 'SaSo', 'Lolium', 'FrSa', 'Fabiaceae','Vicia', 'Sonc', 'Xant', 'LeTr', 'Ranunculus', 'Taraxacum', 'Coytote_Bush','BoMa', 'DiSp', 'AtPx', 'PoAr', 'AcMa', 'GrSt', 'MixedSeedlings','GrGR', 'Melilotus', 'MePo'), as.numeric) %>% 
  mutate_if(is.numeric, list(~replace_na(., 0))) %>%
  filter(!(BaGr_Type_1 == '7' | BaGr_Type_2 == '7')) %>% #remove rows where BaGr is coded as log
  select(-BaGr_Type_1, -BaGr_Type_2, -Coytote_Bush, -Wrack, -Tot_Num_Species, -Shoot_Density, -Length_centimeters, -Patch_Type) %>% 
  mutate(SaSp = SaPa + SaDe) %>% 
  mutate(SaPa_new = SaPa + ((SaPa/SaSp)*PicklePups)) %>% 
  mutate(SaDe_new = SaDe + ((SaDe/SaSp)*PicklePups)) %>% 
  mutate(Grass = GrGR + LeTr + MixedSeedlings) %>% 
  mutate(BaGr = rowSums(across(BaGr_1:BaGr_2), na.rm = T)) %>% 
  select(-BaGr_1, -BaGr_2) %>% 
  mutate(Total_Veg = 25-BaGr) %>%  #Total_Veg is simply what is remaining after subtracting the bare ground
  #mutate(across(SpFo:Total_Veg, ~ .x*4)) %>%  #makes percentages out of the counts
  mutate(across(everything(), ~replace(.x, is.nan(.x), 0))) %>%
  select(-c('GrGR','LeTr','MixedSeedlings','PicklePups', 'SaPa','SaDe')) %>% 
  rename(SaPa = SaPa_new, SaDe = SaDe_new) %>% #putting their original names back after the calculation above
  mutate(Total_Veg2 = rowSums(across(SpFo:Grass), na.rm =T)) %>% #Total_Veg2 adds all the total quadrants each species is present in and combining them all into one total count (can exceed 100)
  mutate(Date = paste0(Year, "-", Month)) 
```

```{r}
#I removed SaSp column from 'vegdatamerged'  df (at the top ^) so that it would not be included in the 'Total_Veg2' calculation

relative <- vegdatamerged %>% 
  filter(Date == "2022-August" | Date == "2023-August") %>% 
  mutate(across(c(7:34), ~na_if(., 0))) %>% 
  mutate(rel_SpFo = (SpFo/Total_Veg2)*100) %>% 
  mutate(rel_SaPa = (SaPa/Total_Veg2)*100) %>%
  mutate(rel_SaDe = (SaDe/Total_Veg2)*100) %>% 
  mutate(across(c(46:48), ~round(.,1)))
  
  
  group_by(Transect_ID, Quadrat) %>% 
  arrange(Date) %>% #arrange by date so the calculations can be made below
  mutate(initial_count = first(SpFo),
         final_count = last(SpFo),
         count_difference = (final_count - initial_count)) %>%
  ungroup() %>% 
  filter(!(Date == "2022-August")) %>%  #this just removes the August2022 count_difference data bc it is a repeat for the august data and we only need one calculation
  group_by(Date, Zone, Shoreline_End, Log_Presence) %>% 
  summarize(mean_cover = mean(count_difference, na.rm = TRUE),   #from here down you calculate summary statistics
            sd_cover = sd(count_difference, na.rm = TRUE),
            n_cover = n()) %>% 
  mutate(se_cover = sd_cover/sqrt(n_cover)) %>% 
  mutate(across(where(is.numeric), ~round(., 0))) %>% 
  mutate(Shoreline_End = factor(Shoreline_End, levels = c("west", "east")),
        Zone = factor(Zone, levels = c("U", "M", "L")),
         Log_Presence = factor(Log_Presence, levels = c("log", "no log"))) 
    
    
```

```{r}
rel_SpFo_barplot <- ggplot(relative, 
                        mapping = aes(x = Zone,
                                y = rel_SpFo,
                                fill = Zone,
                                color =Zone)) +
  geom_col(position = position_dodge(0.85),color = "black", width = 0.85) +
  geom_errorbar(aes(ymin = mean_cover - se_cover,
                    ymax = mean_cover + se_cover),
                size = 0.5, width = 0.1, color = "black", position = position_dodge(0.9)) +
  geom_hline(yintercept=0, linetype="dashed", color = "black") +
  scale_fill_manual(values = cbp) +
  facet_grid(Log_Presence ~ Shoreline_End) +
  scale_x_discrete(labels = c(U = "Upper", M = "Middle", L = "Lower")) +
  coord_cartesian(ylim = c(-15, 30)) + #sets the limit of the y-axis to show a more dramatic difference bw variables
  labs( 
    title = "Mean % Change in *Sarcocornia pacifica* Cover",
    subtitle = "August 2022 to August 2023",
    x = "Marsh Zone",
    y ="Total Vegetation Cover (%)",
    fill = "Marsh Zone",
    caption = "*Error bars reflect standard error",
    tag = "Veg_plots.Rmd-SaPa_change_barplot") +
  theme_bw(base_size = 10) +
  theme(axis.title = element_text(face = "bold", size=14),
        #legend.title = element_text(face = "bold", size=14),
        #legend.text=element_text(size=12),
        legend.position = "none",
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 10),
        plot.title = element_text(face = "bold", size = 13),
        plot.caption = element_text(size = 11),
        plot.subtitle = element_text(size = 11),
        plot.tag = element_text(size = 6, angle = 90),
        plot.tag.position = "right",
        strip.text = element_text(size = 13, color = "black")) +
  geom_text(aes(label = mean_cover, y = mean_cover + se_cover), #geom text is for the labels over the bars
                vjust = -1,  #higher values shift text down
                hjust = 0.5, #higher values shift text horizontally left
                position = position_stack(),
                color = "black",
            size = 3.25)

rel_SpFo_barplot
```

